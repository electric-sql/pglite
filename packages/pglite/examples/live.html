<button id="start">start</button><button id="add">Add</button>
<pre id="output"></pre>
<script type="module">
  import { PGlite } from "../dist/index.js";
  import { live } from "../dist/live/index.js";

  const output = document.getElementById("output");
  const startBtn = document.getElementById("start");
  const addBtn = document.getElementById("add");
  let counter = 5;

  const pg = new PGlite({
    extensions: {
      live,
    },
  });
  window.pg = pg;

  await pg.exec(`
    CREATE TABLE IF NOT EXISTS test (
      id SERIAL PRIMARY KEY,
      name TEXT
    );
    INSERT INTO test (name)
    SELECT 'test' || i
    FROM generate_series(1, ${counter}) AS i;
  `);

  startBtn.addEventListener("click", async () => {
    pg.live.query("SELECT * FROM test ORDER BY id DESC;", null, (res) => {
      output.textContent = JSON.stringify(res.rows, null, 2);
    });
  });

  addBtn.addEventListener("click", async () => {
    await pg.query("INSERT INTO test (name) VALUES ($1);", [
      `test${++counter}`,
    ]);
  });
</script>
